// {namespace name=backend/viison_pickware_erp_order_status_based_position_update/main}
Ext.define("Shopware.apps.ViisonPickwareERPOrderStatusBasedPositionUpdate.controller.Detail",{ override:"Shopware.apps.Order.controller.Detail",skipAlert:false,onSaveOverview:function(i,e){ var t=this.getDetailWindow().down("order-overview-panel").editForm.getForm();var s=t.getFields().findBy(function(i){ return i.name==="status"});var l=s.viisonOldValue;var a=t.getValues().status;if(!this.skipAlert&&l!==a&&(a===4||a===7)){ var r=a===4?'{s name=alert/single/message/cancelled}{/s}':'{s name=alert/single/message/completely_shipped}{/s}';ViisonPickwareBinLocationSelectionAlert.selectWarehouse('{s name=alert/title}{/s}',r,Ext.Msg.YESNO,function(t,s){ if(t==="yes"){ if(a===4){ i.viisonPickwareERPcancelShippingCosts()}i.getPositions().each(function(i){ if(a===4){ i.cancelEntirely();i.commit()}else if(a===7){ i.set("shipped",i.get("quantity"))}});i.getProxy().extraParams=i.getProxy().extraParams||{ };i.getProxy().extraParams.warehouseId=s.get("id")}this.skipAlert=true;this.onSaveOverview(i,e)},this)}else{ this.skipAlert=false;this.callParent(arguments);s.viisonOldValue=a}}});
