Ext.define("Shopware.apps.ViisonCommonAnalytics.controller.Main",{ override:"Shopware.apps.Analytics.controller.Main",constructor:function(){ this.viisonCommonAnalytics={ analyses:Object.create(null),selectedAnalysisId:null};return this.callParent(arguments)},addViisonCommonAnalysis:function(t,e){ if(Object.prototype.hasOwnProperty(t)){ throw new Error("Invalid name for VIISON analysis id: "+t)}this.viisonCommonAnalytics.analyses[t]=e},viisonCommonAnalyticsGetAnalysisParams:function(t){ var e=Object.create(null);t.moduleHandler.onBuildRequestParamMap(this,t,e);return e},viisonCommonAnalyticsOnExport:function(t){ var e=this.viisonCommonAnalyticsGetAnalysisParams(t);var i=this.currentStore.getProxy().url;if(i.indexOf("?")===-1){ i+="?"}else{ i+="&"}i+="format=csv&";var s=[];Ext.each(Object.keys(e),function(t){ var i=e[t];if(i===undefined||i===""){ return}s.push(encodeURIComponent(t)+"="+encodeURIComponent(i))});i+=s.join("&");var n=Ext.create("Ext.form.Panel",{ standardSubmit:true,target:"iframe"});n.submit({ method:"POST",url:i})},viisonCommonAnalyticsGetToolbar:function(){ var t={ ref:"ViisonCommonAnalysisToolbar",selector:"analytics-toolbar"};var e=this.refs;try{ var i=Ext.clone(this.refs);i=i||[];i=i.concat(t);this.refs=i;this.ref(this.refs);return this.getViisonCommonAnalysisToolbar()}finally{ if(this.refs!==e){ this.refs=e;this.ref(this.refs)}}},viisonCommonAnalyticsOnToolbarRefreshed:function(){ this.ref(this.refs)},viisonCommonAnalyticsRenderDataOutput:function(t,e,i){ var s="widget.analytics-chart-"+e.data.id;var n="widget.analytics-table-"+e.data.id;var a=this.getPanel();var o=true;Ext.suspendLayouts();a.removeAll(true);a.setLoading(true);Ext.apply(t.getProxy().extraParams,{ node:"root"});var r=this.viisonCommonAnalyticsGetAnalysisParams(i);Ext.each(Object.keys(r),function(e){ var i=r[e];if(i===undefined||i===""){ delete t.getProxy().extraParams[e]}t.getProxy().extraParams[e]=i});this.currentStore=t;this.currentNavigationItem=e;if(this.getNavigation()){ this.getNavigation().setLoading(true)}t.load({ scope:this,callback:function(i,r){ if(this.getNavigation()){ this.getNavigation().setLoading(false)}a.setLoading(false);if(r.success===false){ return}if(Ext.ClassManager.getNameByAlias(s)){ var l=Ext.create(s,{ store:t,shopStore:this.shopStore,shopSelection:this.getShopSelection().value});a.add(l)}else{ o=false}if(Ext.ClassManager.getNameByAlias(n)){ var c=Ext.create(n,{ store:t,shopStore:this.shopStore,shopSelection:this.getShopSelection().value});a.add(c)}else{ o=false}if(e.raw.multiShop){ this.getShopSelection().show()}else{ this.getShopSelection().hide()}if(!(e.data.id==="article"&&e.data.action==="order_viison_article_analytics_article")){ if(this.getCategorySelection!==undefined){ this.getCategorySelection().hide()}if(this.getCustomerGroupsSelection!==undefined){ this.getCustomerGroupsSelection().hide()}}var u;if(!o){ this.getLayoutButton().hide();u=0}else{ this.getLayoutButton().show();u=this.getLayoutButton().getActiveItem();u=u.layout==="table"?0:1}a.getLayout().setActiveItem(u);Ext.resumeLayouts(true)}})},onExport:function(){ if(this.viisonCommonAnalytics.selectedAnalysisId!==null){ return this.viisonCommonAnalyticsOnExport(this.viisonCommonAnalytics.analyses[this.viisonCommonAnalytics.selectedAnalysisId])}return this.callParent(arguments)},renderDataOutput:function(t,e){ var i=null;var s=this.viisonCommonAnalytics.selectedAnalysisId;var n=null;if(s!==null){ n=this.viisonCommonAnalytics.analyses[s]}this.viisonCommonAnalytics.selectedAnalysisId=null;if(e.raw.viisonCommonAnalysisId!==undefined){ var a=e.raw.viisonCommonAnalysisId;i=this.viisonCommonAnalytics.analyses[a];if(n!==null){ n.moduleHandler.onLeaveAnalysis(this,t,e,n,i)}i.moduleHandler.onBeforeRenderDataOutput(this,t,e,n,i);this.viisonCommonAnalytics.selectedAnalysisId=a;return this.viisonCommonAnalyticsRenderDataOutput(t,e,i)}if(n!==null){ n.moduleHandler.onLeaveAnalysis(this,t,e,n,null)}this.viisonCommonAnalytics.selectedAnalysisId=null;return this.callParent(arguments)}});
