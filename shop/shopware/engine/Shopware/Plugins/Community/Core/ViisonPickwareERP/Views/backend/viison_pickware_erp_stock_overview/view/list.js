// {namespace name=backend/viison_pickware_erp_stock_overview/main}
Ext.define("Shopware.apps.ViisonPickwareERPStockOverview.view.List",{ extend:"Ext.grid.Panel",alias:"widget.viison_pickware_erp_stock_overview-list",cls:"x-tabpanel-child viison-common--grid has--vertical-lines",style:"border-left:none;border-top:none;",selType:"rowmodel",viewConfig:{ getRowClass:function(i){ return!i.isValidStock()?"is--warning":""}},listeners:{ select:function(i,e){ this.fireEvent("showOrders",e)}},renderPlanningIndicatorIcon:function(i,e,t){ var l=.1;var s=t.get("stockmin");var r=t.get("salesWithinPlanningInterval");var I=s>r*(1+l);var o=s*(1+l)<r;if(o){ e.tdAttr='data-qtip="{s name=list/column/stockmin_understocked}{/s}"';e.tdCls="has--icon is--trend-down"}if(I){ e.tdAttr='data-qtip="{s name=list/column/stockmin_overstocked}{/s}"';e.tdCls="has--icon is--trend-up"}return i},initComponent:function(){ this.savedSortableColumns=[];this.rowEditing=Ext.create("Ext.grid.plugin.RowEditing",{ clicksToEdit:2,listeners:{ scope:this,edit:function(i,e){ this.fireEvent("saveRecord",e.record)}}});this.plugins=[this.rowEditing];this.columns=[{ header:'{s name=list/column/article_number}{/s}',sortable:true,dataIndex:"orderNumber",flex:1},{ header:'{s name=list/column/article_name}{/s}',sortable:true,dataIndex:"articleName",flex:2},{ header:'{s name=list/column/supplier_name}{/s}',sortable:true,dataIndex:"supplier",flex:1},{ header:'{s name=list/column/available_stock/label}{/s}',dataIndex:"instock",align:"right",sortable:true,flex:1,editor:{ xtype:"numberfield",allowBlank:false}},{ header:'{s name=list/column/reserved_stock/label}{/s}',dataIndex:"not_sent",align:"right",sortable:true,flex:1,renderer:function(i,e,t){ if(!t.isValidStock()){ e.tdCls="has--icon is--warning"}return i}},{ header:'{s name=list/column/physical_stock/label}{/s}',dataIndex:"stock",align:"right",sortable:true,flex:1},{ header:'{s name=list/column/sales_within_planning_interval}{/s}',dataIndex:"salesWithinPlanningInterval",align:"right",sortable:true,flex:1},{ header:'{s name=list/column/stockmin}{/s}',dataIndex:"stockmin",align:"right",sortable:true,flex:1,editor:{ xtype:"numberfield",allowBlank:false},renderer:this.renderPlanningIndicatorIcon},{ xtype:"actioncolumn",width:50,items:[{ iconCls:"sprite-inbox",tooltip:'{s name=list/column/action/open_article/tooltip}{/s}',scope:this,handler:function(i,e){ this.fireEvent("openArticle",i.getStore().getAt(e))}},{ iconCls:"sprite-pencil",tooltip:'{s name=list/column/action/edit/tooltip}{/s}',scope:this,handler:function(i,e){ this.fireEvent("editRow",i.getStore().getAt(e))}}]}];this.dockedItems=[this.getToolbar(),this.getPagingbar()];this.callParent(arguments)},getPagingbar:function(){ return{ xtype:"viison_common_pagination_toolbar-toolbar",store:this.store,pageSizeLabel:'{s name=list/paging/page_size}{/s}'}},getToolbar:function(){ return{ xtype:"toolbar",dock:"top",ui:"shopware-ui",padding:"5 5 5 5",border:false,items:[{ xtype:"checkboxfield",margin:"0 0 0 8",cls:"viison-common--checkbox-with-boxlabel",boxLabel:'{s name=label/filter/show_problems}{/s}',listeners:{ scope:this,change:function(i){ this.filterProblems(i.value)}}},"->",{ xtype:"textfield",name:"searchfield",cls:"searchfield",width:200,enableKeyEvents:true,emptyText:'{s name=search/initialText}{/s}',listeners:{ buffer:500,scope:this,change:function(i){ this.applyFilter(i.value)}}}]}},disableSorting:function(i){ if(i&&this.savedSortableColumns.length===0){ this.savedSortableColumns=this.columns.filter(function(i){ return i.sortable})}if(i){ this.store.sorters.clear()}Ext.Array.forEach(this.savedSortableColumns,function(e){ e.sortable=!i})},filterProblems:function(i){ this.disableSorting(i);this.store.clearFilter(true);this.store.getProxy().extraParams.filterStockProblems=i;this.store.currentPage=1;this.store.load()},applyFilter:function(i){ this.store.clearFilter(true);this.store.getProxy().extraParams.filterStr=i;this.store.currentPage=1;this.store.load()}});
