// {namespace name=backend/viison_pickware_erp_article_stock_field_set/main}
Ext.define("Shopware.apps.ViisonPickwareERPArticleStockFieldSet.controller.Detail",{ override:"Shopware.apps.Article.controller.Detail",init:function(){ this.callParent(arguments);this.control({ "viison_pickware_erp_article_stock_field_set-stock_field_set":{ viisonPickareERPSaveAvailableStock:this.onViisonPickareERPSaveAvailableStock}})},onSaveArticle:function(i,e,t){ var a=i||this.getMainWindow();var l=Ext.isObject(t)&&Ext.isFunction(t.callback)?t.callback:Ext.emptyFn;t.callback=function(i,e){ if(i&&e){ var t=i.getMainDetail().first();var s=a.down("viison_pickware_erp_article_stock_field_set-stock_field_set");s.reloadData(t)}l(i,e)};if(i){ var s=i.down("viison_pickware_erp_article_stock_field_set-stock_field_set");if(!s.cancelChangedAvailableStockButton.isHidden()){ s.cancelChangedAvailableStockButtonHandler()}}this.callParent([i,e,t])},reconfigureAssociationComponents:function(){ var i=this.getMainWindow().down("viison_pickware_erp_article_stock_field_set-stock_field_set");i.isReloadingData=true;this.callParent(arguments);i.isReloadingData=false;i.reloadData(this.getMainWindow().article.getMainDetail().first())},onViisonPickareERPSaveAvailableStock:function(i,e,t,a){ this.viisonPickareERPUpdateAvailableStock(i,e,t);this.getMainWindow().setLoading(true);Ext.Ajax.request({ url:'{url controller="ViisonPickwareERPArticleStock" action="saveAvailableStock"}',method:"POST",params:{ articleDetailId:e.get("id"),availableStock:t},scope:this,callback:function(l,s,c){ var o=c.responseText&&Ext.JSON.decode(c.responseText,true);var n=s&&o&&o.success;if(n){ Shopware.Notification.createGrowlMessage('{s name="action/save_available_stock/success/title"}{/s}',Ext.String.format('{s name="action/save_available_stock/success/message"}{/s}',e.get("number"),e.get("id"),a,t),"Pickware ERP");this.refreshArticleList()}else{ Shopware.Notification.createGrowlMessage('{s name="action/save_available_stock/failure/title"}{/s}',Ext.String.format('{s name="action/save_available_stock/failure/message"}{/s}',e.get("number"),e.get("id")),"Pickware ERP");this.viisonPickareERPUpdateAvailableStock(i,e,a)}this.getMainWindow().setLoading(false)}})},viisonPickareERPUpdateAvailableStock:function(i,e,t){ e.set("inStock",t);e.set("viisonReservedStock",0);i.reloadData(e)}});
