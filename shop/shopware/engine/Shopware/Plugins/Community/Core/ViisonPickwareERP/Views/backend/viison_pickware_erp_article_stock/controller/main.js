// {namespace name=backend/viison_pickware_erp_article_stock/main}
Ext.define("Shopware.apps.ViisonPickwareERPArticleStock.controller.Main",{ extend:"Ext.app.Controller",init:function(){ this.control({ "viison_pickware_erp_article_stock-detail-stock_list":{ typeChanged:this.onTypeChanged,saveStockEntry:this.onSaveStockEntry,showOrder:this.onShowOrder,showSupplierOrder:this.onShowSupplierOrder},"viison_pickware_erp_article_stock-detail-stock_list viison_common_variant_combo_box-combo_box":{ variantChanged:this.onVariantChanged},"viison_pickware_erp_article_stock-detail-stock_list viison_pickware_erp_warehouse_management-warehouse_combo_box":{ warehouseChanged:this.onWarehouseChanged}});this.stockStore=Ext.create("Shopware.apps.ViisonPickwareERPArticleStock.store.Stock",{ });this.stockTypeStore=Ext.create("Shopware.apps.ViisonPickwareERPArticleStock.store.StockType",{ });this.callParent(arguments)},createArticleStockListTab:function(){ this.viisonPickwareERPStockListTab=Ext.create("Shopware.apps.ViisonPickwareERPArticleStock.view.detail.StockList",{ store:this.stockStore,stockTypeStore:this.stockTypeStore});this.subApplication.on("ProductModule:storesChanged",this.articleChanged,this.viisonPickwareERPStockListTab);var e=this.viisonPickwareERPStockListTab.down("viison_common_variant_combo_box-combo_box");e.setArticle(this.article);return this.viisonPickwareERPStockListTab},onTypeChanged:function(e){ this.selectedType=e;this.loadStocks()},onVariantChanged:function(e){ this.selectedVariant=e;this.loadStocks();if(this.selectedVariant&&this.selectedVariant.get("viisonNotRelevantForStockManager")){ this.viisonPickwareERPStockListTab.gridPanel.disable();this.viisonPickwareERPStockListTab.notStockManagedInfo.show()}else{ this.viisonPickwareERPStockListTab.gridPanel.enable();this.viisonPickwareERPStockListTab.notStockManagedInfo.hide()}},onWarehouseChanged:function(e){ this.selectedWarehouse=e;this.loadStocks()},onSaveStockEntry:function(e,i){ if(i!==true){ Ext.Msg.confirm('{s name=alert/save_stock_entry/title}{/s}','{s name=alert/save_stock_entry/message}{/s}',function(i){ e.getProxy().extraParams.updateChildren=i==="yes";this.onSaveStockEntry(e,true)},this);return}e.save({ callback:function(i,t){ if(t.success){ if(e.getProxy().extraParams.updateChildren){ e.store.load()}Shopware.Notification.createGrowlMessage('{s name=notification/save_stock_entry/success/title}{/s}','{s name=notification/save_stock_entry/success/message}{/s}',"Pickware")}else{ Shopware.Notification.createGrowlMessage('{s name=notification/save_stock_entry/failure/title}{/s}','{s name=notification/save_stock_entry/failure/message}{/s}',"Pickware")}}})},onShowOrder:function(e){ Shopware.app.Application.addSubApplication({ name:"Shopware.apps.Order",params:{ orderId:e.get("orderId"),reshipmentId:e.get("reshipmentId")}})},onShowSupplierOrder:function(e){ Shopware.app.Application.addSubApplication({ name:"Shopware.apps.ViisonPickwareERPSupplierOrders",params:{ orderId:e.get("supplierOrderId")}})},loadStocks:function(){ if(!this.selectedVariant||!this.selectedWarehouse){ return}if(this.selectedVariant.get("viisonNotRelevantForStockManager")){ this.stockStore.clearFilter(true);this.stockStore.loadData([]);return}if(this.selectedType){ this.stockStore.filters.add("type",Ext.create("Ext.util.Filter",{ property:"stock.type",value:this.selectedType}))}else{ this.stockStore.filters.removeAtKey("type")}this.stockStore.filters.add("articleDetailId",Ext.create("Ext.util.Filter",{ property:"stock.articleDetailId",value:this.selectedVariant.get("id")}));this.stockStore.filters.add("warehouseId",Ext.create("Ext.util.Filter",{ property:"stock.warehouseId",value:this.selectedWarehouse.get("id")}));this.stockStore.loadPage(1)},articleChanged:function(e){ this.article=e;this.down("viison_common_variant_combo_box-combo_box").setArticle(e)}});
