// {namespace name=backend/viison_pickware_erp_stock_initialization/main}
Ext.define("Shopware.apps.ViisonPickwareERPStockInitialization.controller.Main",{ extend:"Enlight.app.Controller",refs:[{ ref:"articleGrid",selector:"viison_pickware_erp_stock_initialization-list"},{ ref:"main",selector:"viison_pickware_erp_stock_initialization-main"}],init:function(){ this.control({ "viison_pickware_erp_stock_initialization-list":{ openArticle:this.onOpenArticle,editRow:this.onEditRow,applyChanges:this.onApplyChanges,initializeAll:this.onInitializeAll}});this.mainWindow=this.getView("Main").create({ store:this.getStore("Stock")}).show()},onOpenArticle:function(i){ Shopware.app.Application.addSubApplication({ name:"Shopware.apps.Article",action:"detail",params:{ articleId:i.get("articleId")}})},onEditRow:function(i){ this.getArticleGrid().rowEditing.startEdit(i,0)},onApplyChanges:function(i){ var e=i.getSelectionModel().getSelection();if(e.length>0){ this.getMain().setLoading(true);this.createStockEntries(e)}},onInitializeAll:function(i,e){ if(e!==true){ Ext.Msg.confirm('{s name=alert/initialize_all/title}{/s}','{s name=alert/initialize_all/message}{/s}',function(e){ if(e==="yes"){ this.onInitializeAll(i,true)}},this);return}this.getMain().setLoading(true);function t(){ Ext.Msg.confirm('{s name=alert/initialize_all/title}{/s}','{s name=notification/initialize_all/fail_message}{/s}',function(e){ if(e==="yes"){ this.onInitializeAll(i,true)}},this)}Ext.Ajax.request({ url:'{url controller=ViisonPickwareERPStockInitialization action=initializeAllArticles}',method:"GET",scope:this,callback:function(){ this.getMain().setLoading(false);i.store.reload();i.getView().refresh()},success:function(i){ var e=Ext.JSON.decode(i.responseText,true);if(!e){ return}if(e.success){ Shopware.Notification.createGrowlMessage('{s name=notification/initialize_all/title}{/s}','{s name=notification/initialize_all/success_message}{/s}',"Pickware")}else if(e.conflict){ Ext.Msg.alert({ title:'{s name=alert/initialize_all/title}{/s}',msg:'{s name=notification/initialize_all/conflict_message}{/s}',buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}else{ t()}},failure:t})},createStockEntries:function(i){ var e=Ext.Array.map(i,function(i){ return i.get("detailsId")});Ext.Ajax.request({ url:'{url controller="ViisonPickwareERPStockInitialization" action="createStockEntry"}',method:"POST",jsonData:{ detailIds:e},scope:this,callback:function(){ this.getMain().setLoading(false);this.getArticleGrid().store.reload();this.getArticleGrid().getView().refresh()}})}});
