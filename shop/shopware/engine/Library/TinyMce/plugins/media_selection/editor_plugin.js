!function(){tinymce.create("tinymce.plugins.MediaSelectionPlugin",{ed:null,imageCls:"tinymce-editor-image",linkCls:"tinymce-editor-link",videoCls:"tinymce-editor-video",audioCls:"tinymce-editor-audio",url:null,init:function(e,t){var n=this;n.ed=e,n.url=t,e.addCommand("mceMediaSelection",function(){var i=!1;"function"!=typeof Shopware.app.Application.addSubApplication&&Ext.Error.raise({msg:"Your ExtJS application does not support sub applications",option:[e,t]}),n.ed.settings&&n.ed.settings.fullscreen_is_enabled&&(i=!0),Shopware.app.Application.addSubApplication({name:"Shopware.apps.MediaManager",layout:"small",forceToFront:i,selectionMode:"single",eventScope:n,mediaSelectionCallback:n._processImage})}),e.addButton("media_selection",{title:"Media Selection",cls:"tinymce-media-selection",cmd:"mceMediaSelection",image:t+"/assets/inbox-image.png"})},getInfo:function(){return{longname:"MediaManager - MediaSelection",author:"shopware AG - st.pohl",authorurl:"http://www.shopware.com",infourl:"http://developers.shopware.com",version:"1.1.1"}},_processImage:function(e){var t,n,i=this,a=i.ed,o=e.up("window"),r=o.down(".mediamanager-media-view");r="grid"===r.selectedLayout?r.dataView:r.cardContainer.getLayout().getActiveItem(),t=r.getSelectionModel(),n=t.getSelection(),Ext.each(n,function(e){var t=e.get("type");"VIDEO"===t?i._insertVideo(e):"IMAGE"===t?i._insertImage(e):"MUSIC"===t?i._insertAudio(e):i._insertLink(e),a.undoManager.add()}),o.destroy()},_insertImage:function(e){var t,n=this,i=n.ed,a=Shopware.ModuleManager.uuidGenerator.generate();t={id:n.imageCls+"-"+a,"class":n.imageCls+" "+n.imageCls+"-"+a,alt:e.get("name"),"data-src":e.get("virtualPath"),src:n.url+"/assets/placeholder-image.png"},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("img",t),{skip_undo:1});var o=new Event("insertMedia");return document.dispatchEvent(o),!0},_insertLink:function(e){var t,n=this,i=n.ed;return t={"class":n.linkCls,href:e.get("path"),title:e.get("name"),target:"_blank"},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("a",t,e.get("name")),{skip_undo:1}),!0},_insertVideo:function(e){var t,n=this,i=n.ed;return t={"class":n.videoCls,width:320,height:240,src:e.get("path"),controls:!0},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("video",t),{skip_undo:1}),!0},_insertAudio:function(e){var t,n=this,i=n.ed;return t={"class":n.audioCls,src:i.settings.document_base_url+e.get("path"),controls:!0},i.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("audio",t),{skip_undo:1}),!0}}),tinymce.PluginManager.add("media_selection",tinymce.plugins.MediaSelectionPlugin)}();
