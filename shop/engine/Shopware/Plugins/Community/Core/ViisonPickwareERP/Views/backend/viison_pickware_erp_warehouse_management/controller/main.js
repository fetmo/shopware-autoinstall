Ext.define("Shopware.apps.ViisonPickwareERPWarehouseManagement.controller.Main",{ extend:"Ext.app.Controller",mixins:["Shopware.apps.ViisonCommonApp.Mixin"],refs:[{ ref:"detailView",selector:"viison_pickware_erp_warehouse_management-main-details"}],viisonSnippetNamespace:"backend/viison_pickware_erp_warehouse_management/main",init:function(){ this.control({ "viison_pickware_erp_warehouse_management-main-list button[action=addWarehouse]":{ click:this.onAddWarehouse},"viison_pickware_erp_warehouse_management-main-list":{ editWarehouse:this.onEditWarehouse,deleteWarehouse:this.onDeleteWarehouse,select:this.onWarehouseSelected,searchFieldChanged:this.onSearchFieldChanged}});this.warehouseStore=Ext.create("Shopware.apps.ViisonPickwareERPWarehouseManagement.store.Warehouse",{ });this.warehouseStore.on("load",this.clearDetailView,this);this.warehouseStore.load();this.mainView=this.getView("Main").create({ warehouseStore:this.warehouseStore});this.callParent(arguments)},onAddWarehouse:function(){ var e=Ext.create("Shopware.apps.ViisonPickwareERPWarehouseManagement.model.Warehouse",{ });this.getController("Edit").createEditWindow(e)},onEditWarehouse:function(e){ this.getController("Edit").createEditWindow(e)},onDeleteWarehouse:function(e){ Ext.Msg.confirm(this.getViisonSnippet("alert/title"),this.getViisonSnippet("alert/message/delete"),function(i){ if(i!=="yes"){ return}this.warehouseStore.remove(e);this.syncWarehouses(this.getViisonSnippet("notification/error/message/delete"),function(i,t){ if(!i&&t.issues){ Shopware.Notification.createStickyGrowlMessage({ title:this.getViisonSnippet("notification/error/title"),text:this.getViisonSnippet("notification/error/message/delete/failed_with_issues")+" &bull; "+t.issues[e.get("id")].join(" &bull; ")})}})},this)},onWarehouseSelected:function(e,i){ this.getDetailView().dataView.update(i.data);this.getDetailView().expand()},onSearchFieldChanged:function(e){ this.warehouseStore.getProxy().extraParams.query=e;this.warehouseStore.loadPage(1)},syncWarehouses:function(e,i){ var t=this.warehouseStore.getNewRecords().length+this.warehouseStore.getModifiedRecords().length+this.warehouseStore.getRemovedRecords().length;if(t===0){ if(Ext.isFunction(i)){ i(true)}return}this.selectedRow=null;this.mainView.setLoading(true);this.warehouseStore.sync({ scope:this,success:function(){ this.mainView.setLoading(false);this.clearDetailView();if(Ext.isFunction(i)){ i(true)}},failure:function(t){ this.mainView.setLoading(false);this.warehouseStore.rejectChanges();var a=e||"";Shopware.Notification.createGrowlMessage(this.getViisonSnippet("notification/error/title"),a,"ViisonPickwareERPWarehouseManagement");if(Ext.isFunction(i)){ i(false,t.proxy.reader.jsonData)}}})},clearDetailView:function(){ this.getDetailView().dataView.update({ })}});
