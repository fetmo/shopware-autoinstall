// {namespace name=backend/viison_pickware_erp_supplier_orders/main}
Ext.define("Shopware.apps.ViisonPickwareERPSupplierOrders.view.main.List",{ extend:"Ext.grid.Panel",alias:"widget.viison_pickware_erp_supplier_orders-main-list",split:true,border:true,autoScroll:true,viewConfig:{ enableTextSelection:true},cls:"x-tabpanel-child",initComponent:function(){ this.viewConfig={ getRowClass:function(e){ var i=new Date;i.setHours(0,0,0,0);var t=false;t=t||e.get("paymentStatus")!==1&&e.get("paymentDueDate")&&i.getTime()>e.get("paymentDueDate").getTime();t=t||e.get("status")<4&&e.get("deliveryDate")&&i.getTime()>e.get("deliveryDate").getTime();return t?"x-grid-row-viison-warning":""}};this.plugins=[Ext.create("Ext.grid.plugin.RowEditing",{ clicksToMoveEditor:1,autoCancel:false,listeners:{ edit:function(e,i){ if(i.originalValues.status===4&&i.newValues.status!==i.originalValues.status){ i.record.set("status",4);Shopware.Msg.createGrowlMessage('{s name=notification/error/title}{/s}','{s name=notification/error/message/status_change_rejected}{/s}',"Pickware")}i.record.set("deliveryDate",i.newValues.deliveryDate);i.record.set("paymentDueDate",i.newValues.paymentDueDate);this.fireEvent("saveOrder",i.record,i.originalValues)},scope:this}})];this.columns=this.createColumns();this.dockedItems=this.createDockedItems();this.callParent(arguments)},createColumns:function(){ return[{ xtype:"datecolumn",header:'{s name=order/field/created}{/s}',dataIndex:"created",width:130,format:"d.m.Y H:i"},{ xtype:"gridcolumn",header:'{s name=order/field/order_number}{/s}',dataIndex:"orderNumber",width:85},{ xtype:"gridcolumn",header:'{s name=order/field/supplier_name}{/s}',dataIndex:"supplierId",flex:3,renderer:function(e,i,t){ return t.raw.supplier?t.getSupplier().get("name"):'{s name=list/column/supplier_name/unknown}{/s}'}},{ xtype:"gridcolumn",header:'{s name=order/field/warehouse_name}{/s}',dataIndex:"warehouseId",flex:2,scope:this,renderer:function(e){ var i=this.warehouseStore.findExact("id",e);return i>-1?this.warehouseStore.getAt(i).get("displayName"):'{s name=list/column/warehouse_name/unknown}{/s}'}},{ xtype:"gridcolumn",header:'{s name=order/field/status}{/s}',dataIndex:"status",flex:2,editor:{ xtype:"combo",store:this.orderStatusStore,valueField:"id",displayField:"description",queryMode:"local",selectOnTab:true,typeAhead:true,triggerAction:"all"},renderer:function(e){ var i=this.orderStatusStore.getById(e);return i===null?"":i.get("description")}},{ xtype:"datecolumn",header:'{s name=order/field/delivery_date}{/s}',dataIndex:"deliveryDate",width:80,format:"d.m.Y",editor:{ xtype:"datefield",allowBlank:true}},{ header:'{s name=order/field/total}{/s}',dataIndex:"total",width:90,align:"right",renderer:ViisonCurrencyFormatter.renderer},{ xtype:"gridcolumn",header:'{s name=order/field/payment_status}{/s}',dataIndex:"paymentStatus",width:90,editor:{ xtype:"combo",store:this.paymentStatusStore,valueField:"id",displayField:"description",queryMode:"local",selectOnTab:true},renderer:function(e){ var i=this.paymentStatusStore.getById(e);return i===null?"":i.get("description")}},{ xtype:"datecolumn",header:'{s name=order/field/payment_due_date}{/s}',dataIndex:"paymentDueDate",width:80,format:"d.m.Y",editor:{ xtype:"datefield",allowBlank:true}},{ xtype:"actioncolumn",width:125,items:[{ iconCls:"sprite-mail-send",action:"sendOrderMail",tooltip:'{s name=list/tooltip/send_mail}{/s}',handler:function(e,i){ this.fireEvent("sendOrderMail",e.getStore().getAt(i))},scope:this},{ iconCls:"sprite-inbox-download",action:"downloadOrderPDF",tooltip:'{s name=list/tooltip/download_pdf}{/s}',handler:function(e,i){ this.fireEvent("downloadOrderPDF",e.getStore().getAt(i))},scope:this},{ iconCls:"sprite-arrow-continue-270-left",action:"downloadOrderCSV",tooltip:'{s name=list/tooltip/download_csv}{/s}',handler:function(e,i){ this.fireEvent("downloadOrderCSV",e.getStore().getAt(i))},scope:this},{ iconCls:"sprite-pencil",action:"editOrder",tooltip:'{s name=list/tooltip/edit}{/s}',handler:function(e,i){ this.fireEvent("editOrder",e.getStore().getAt(i))},scope:this},{ iconCls:"sprite-minus-circle",action:"deleteOrder",tooltip:'{s name=list/tooltip/delete}{/s}',handler:function(e,i){ this.fireEvent("deleteOrder",e.getStore().getAt(i))},scope:this}]}]},createDockedItems:function(){ var e=Ext.create("Ext.toolbar.Toolbar",{ dock:"top",ui:"shopware-ui",items:[{ xtype:"button",text:'{s name=list/toolbar/button/add}{/s}',iconCls:"sprite-plus-circle-frame",action:"addOrder"},{ xtype:"tbspacer",width:20},{ xtype:"viison_pickware_erp_warehouse_management-warehouse_combo_box",name:"warehouseSelection",allowBlank:true},"->",{ xtype:"textfield",name:"searchfield",cls:"searchfield",width:170,enableKeyEvents:true,emptyText:'{s name=search_field/placeholder}{/s}',listeners:{ buffer:500,change:function(e){ this.fireEvent("searchFieldChanged",e.value)},scope:this}}]});var i={ xtype:"viison_common_pagination_toolbar-toolbar",store:this.store};return[e,i]}});
