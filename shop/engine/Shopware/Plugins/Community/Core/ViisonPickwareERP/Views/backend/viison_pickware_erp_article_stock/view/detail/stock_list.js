// {namespace name=backend/viison_pickware_erp_article_stock/main}
Ext.define("Shopware.apps.ViisonPickwareERPArticleStock.view.detail.StockList",{ extend:"Ext.panel.Panel",alias:"widget.viison_pickware_erp_article_stock-detail-stock_list",layout:"fit",border:false,initComponent:function(){ this.notStockManagedInfo=Ext.create("Ext.container.Container",{ xtype:"container",cls:"viison-common--info-panel has--shadow",html:'{s name=toolbar/not_relevant_for_stock_manager_info/message}{/s}',width:"100%",margin:10,hidden:true});this.items=[this.createGridPanel()];this.dockedItems=[{ xtype:"container",dock:"top",layout:"vbox",items:[{ xtype:"toolbar",width:"100%",ui:"shopware-ui",padding:7,border:false,items:this.getTopToolbarItems()},this.notStockManagedInfo]}];this.callParent(arguments)},createGridPanel:function(){ this.gridPanel=Ext.create("Ext.grid.Panel",{ xtype:"gridpanel",border:true,autoScroll:true,viewConfig:{ enableTextSelection:true},store:this.store,columns:this.createColumns(),dockedItems:[{ xtype:"viison_common_pagination_toolbar-toolbar",store:this.store}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{ clicksToEdit:2,autoCancel:true,listeners:{ scope:this,edit:function(i,e){ this.fireEvent("saveStockEntry",e.record)}}})]});return this.gridPanel},createColumns:function(){ return[{ header:'{s name=model/stock/type}{/s}',dataIndex:"type",sortable:true,width:80,renderer:function(i){ switch(i){ case"purchase":return'{s name=store/stock_type/purchase}{/s}';case"sale":return'{s name=store/stock_type/sale}{/s}';case"return":return'{s name=store/stock_type/return}{/s}';case"stocktake":return'{s name=store/stock_type/stocktake}{/s}';case"manual":return'{s name=store/stock_type/manual}{/s}';case"incoming":return'{s name=store/stock_type/incoming}{/s}';case"outgoing":return'{s name=store/stock_type/outgoing}{/s}';case"relocation":return'{s name=store/stock_type/relocation}{/s}';case"initialization":return'{s name=store/stock_type/initialization}{/s}';default:return undefined}}},{ header:'{s name=model/stock/article_number}{/s}',dataIndex:"articleNumber",sortable:true,width:100},{ header:'{s name=model/stock/article_name}{/s}',dataIndex:"articleName",sortable:true,flex:1},{ header:'{s name=model/stock/change_amount}{/s}',dataIndex:"changeAmount",sortable:true,width:65,align:"right"},{ header:'{s name=model/stock/old_instock_quantity}{/s}',dataIndex:"oldInstockQuantity",sortable:true,width:70,align:"right"},{ header:'{s name=model/stock/new_instock_quantity}{/s}',dataIndex:"newInstockQuantity",sortable:true,width:70,align:"right"},{ xtype:"numbercolumn",header:ViisonPickwarePurchasePriceHelper.purchasePriceLabel(),dataIndex:"purchasePrice",sortable:true,renderer:ViisonCurrencyFormatter.renderer,width:80,align:"right",editor:{ xtype:"numberfield",allowBlank:false,decimalSeparator:",",decimalPrecision:2,submitLocaleSeparator:false,currencySymbol:ViisonCurrencyFormatter.currencySymbol}},{ header:'{s name=model/stock/username}{/s}',dataIndex:"username",sortable:true,width:120},{ header:'{s name=model/stock/created}{/s}',xtype:"datecolumn",dataIndex:"created",sortable:true,width:120,format:"d.m.Y H:i:s"},{ header:'{s name=model/stock/comment}{/s}',dataIndex:"comment",sortable:false,flex:1,renderer:function(i,e){ if(i===null){ return""}e.tdAttr='data-qtip="'+i+'"';return i}},{ xtype:"actioncolumn",width:55,items:[{ iconCls:"sprite-sticky-notes-pin",getClass:function(i,e,t){ if(t.get("reshipmentId")){ this.items[0].tooltip='{s name=action_column/show_reshipment/tooltip}{/s}'}else if(t.get("orderId")){ this.items[0].tooltip='{s name=action_column/show_order/tooltip}{/s}'}else if(t.get("supplierOrderId")){ this.items[0].tooltip='{s name=action_column/show_supplier_order/tooltip}{/s}'}else{ return"x-hide-visibility"}return undefined},handler:function(i,e){ var t=i.getStore().getAt(e);var I;if(t.get("orderId")){ I="showOrder"}else if(t.get("supplierOrderId")){ I="showSupplierOrder"}else{ return}this.fireEvent(I,t)}.bind(this)},{ iconCls:"sprite-pencil",tooltip:'{s name=action_column/edit_purchase_price/tooltip}{/s}',scope:this,handler:function(i,e){ this.gridPanel.plugins[0].startEdit(e,6)}}]}]},getTopToolbarItems:function(){ var i=Ext.create("Ext.form.field.ComboBox",{ name:"type",valueField:"name",displayField:"title",queryMode:"local",store:this.stockTypeStore,fieldLabel:'{s name=toolbar/filter/type/label}{/s}',labelWidth:40,editable:false,allowBlank:false,forceSelection:true,padding:"0 0 0 20",listeners:{ scope:this,change:function(i,e,t){ if(e!==t){ this.fireEvent("typeChanged",e)}}}});i.select(this.stockTypeStore.getAt(0));return[{ xtype:"viison_common_variant_combo_box-combo_box",name:"variantSelection"},{ xtype:"viison_pickware_erp_warehouse_management-warehouse_combo_box",name:"warehouseSelection"},i]}});
