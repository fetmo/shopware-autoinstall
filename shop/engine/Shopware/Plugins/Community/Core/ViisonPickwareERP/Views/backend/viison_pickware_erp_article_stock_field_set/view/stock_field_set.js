// {namespace name=backend/viison_pickware_erp_article_stock_field_set/main}
Ext.define("Shopware.apps.ViisonPickwareERPArticleStockFieldSet.view.StockFieldSet",{ extend:"Ext.form.FieldSet",alias:"widget.viison_pickware_erp_article_stock_field_set-stock_field_set",title:'{s name=title}{/s}',layout:"column",labelWidth:155,articleDetail:null,onSaleCheckboxHidden:false,isReloadingData:false,fieldNames:{ physicalStock:"viisonPhysicalStockForSale",reservedStock:"viisonReservedStock",notStockManaged:"viisonNotRelevantForStockManager",availableStock:"inStock",minStock:"stockMin",onSale:"lastStock"},stockFieldStyle:{ color:"#475C6A","font-size":"1.3em","font-weight":"bold","text-shadow":"0 1px 0 #fff","text-align":"right"},initComponent:function(){ this.items=[this.createLeftColumn(),this.createRightColumn()];this.setAvailableStockEditButtonHidden(!this.articleDetail||this.articleDetail.phantom);this.callParent(arguments)},reloadData:function(i){ this.isReloadingData=true;this.articleDetail=i;this.setAvailableStockEditButtonHidden(i.phantom);if(i.get("viisonNotRelevantForStockManager")){ this.physicalStockField.up().setDisabled(true);this.physicalStockField.setValue(null);this.physicalStockField.name=null;this.physicalStockField.helpIconEl.hide(false);this.reservedStockField.up().setDisabled(true);this.reservedStockField.setValue(null);this.reservedStockField.name=null;this.reservedStockField.helpIconEl.hide(false);this.reservedStockField.up().child("label").setText(null);this.availableStockEditField.up().child("label").setText(null);this.minStockField.setDisabled(true)}else{ this.physicalStockField.up().setDisabled(false);this.physicalStockField.name=this.fieldNames.physicalStock;this.physicalStockField.helpIconEl.show(false);this.reservedStockField.up().setDisabled(false);this.reservedStockField.name=this.fieldNames.reservedStock;this.reservedStockField.helpIconEl.show(false);this.reservedStockField.up().child("label").setText("-");this.availableStockEditField.up().child("label").setText("=");this.minStockField.setDisabled(false);this.physicalStockField.setValue(this.articleDetail.get("viisonPhysicalStockForSale"));this.reservedStockField.setValue(this.articleDetail.get("viisonReservedStock"))}this.notStockManagedField.setValue(this.articleDetail.get("viisonNotRelevantForStockManager"));this.availableStockField.setValue(this.articleDetail.get("inStock"));this.availableStockEditField.setValue(this.articleDetail.get("inStock"));this.isReloadingData=false},setAvailableStockEditButtonHidden:function(i){ this.editAvailableStockButton[i?"hide":"show"]();this.editAvailableStockButtonPlaceholder[i?"show":"hide"]()},createLeftColumn:function(){ return{ xtype:"container",columnWidth:.5,layout:"anchor",defaults:{ anchor:"100%",labelWidth:155},padding:"0 20 0 0",items:[this.createPhysicalStockFieldContainer(),this.createReservedStockFieldContainer(),this.createAvailableStockFieldContainer()]}},createRightColumn:function(){ this.minStockField=Ext.create("Ext.form.field.Number",{ name:this.fieldNames.minStock,fieldLabel:'{s name=detail/settings/min_stock namespace=backend/article/view/main}{/s}',labelWidth:this.labelWidth,decimalPrecision:0});this.onSaleField=Ext.create("Ext.form.field.Checkbox",{ name:this.fieldNames.onSale,fieldLabel:'{s name=detail/settings/on_sale_field namespace=backend/article/view/main}{/s}',labelWidth:this.labelWidth,boxLabel:'{s name=detail/settings/on_sale_box namespace=backend/article/view/main}{/s}',inputValue:true,uncheckedValue:false,hidden:this.onSaleCheckboxHidden});this.notStockManagedField=Ext.create("Ext.form.field.Checkbox",{ name:this.fieldNames.notStockManaged,fieldLabel:'{s name=field/not_stock_managed/field_label}{/s}',labelWidth:this.labelWidth,boxLabel:'{s name=field/not_stock_managed/box_label}{/s}',helpText:'{s name=field/not_stock_managed/help_text}{/s}',inputValue:true,uncheckedValue:false});this.notStockManagedField.on("change",function(i,e){ if(this.isReloadingData||i.readOnly||e!==true){ return}Ext.Msg.confirm('{s name=field/not_stock_managed/change_alert/title}{/s}','{s name=field/not_stock_managed/change_alert/message}{/s}',function(i){ if(i!=="yes"){ this.notStockManagedField.setValue(false)}},this)},this);return{ xtype:"container",columnWidth:.5,layout:"anchor",defaults:{ anchor:"100%",labelWidth:155},items:[this.minStockField,this.onSaleField,this.notStockManagedField]}},createPhysicalStockFieldContainer:function(){ this.physicalStockField=Ext.create("Ext.form.field.Display",{ name:this.fieldNames.physicalStock,helpText:'{s name=field/physical_stock/help_text}{/s}',width:100,fieldStyle:this.stockFieldStyle});return this.createFieldContainer('{s name=field/physical_stock/label}{/s}',[{ xtype:"container",flex:1},this.physicalStockField,{ xtype:"container",width:20}])},createReservedStockFieldContainer:function(){ this.reservedStockField=Ext.create("Ext.form.field.Display",{ name:this.fieldNames.reservedStock,helpText:'{s name=field/reserved_stock/help_text}{/s}',width:100,fieldStyle:this.stockFieldStyle});return this.createFieldContainer('{s name=field/reserved_stock/label}{/s}',[{ xtype:"label",text:"-",padding:"5 10 0 0",flex:1,style:{ "font-size":"1.3em","text-align":"right"}},this.reservedStockField,{ xtype:"container",width:20}])},createAvailableStockFieldContainer:function(){ this.availableStockField=Ext.create("Ext.form.field.Display",{ name:this.fieldNames.availableStock,helpText:'{s name=field/available_stock/help_text}{/s}',width:100,fieldStyle:this.stockFieldStyle});this.availableStockEditField=Ext.create("Ext.form.field.Number",{ width:80,decimalPrecision:0,hidden:true,fieldStyle:{ "text-align":"right"},listeners:{ scope:this,change:function(i,e){ if(this.articleDetail.get("viisonNotRelevantForStockManager")){ return}if(this.articleDetail.phantom){ this.physicalStockField.setValue(e)}else{ this.reservedStockField.setValue(this.articleDetail.get("viisonPhysicalStockForSale")-e)}}}});this.editAvailableStockButton=this.createIconButton("sprite-pencil",'{s name=field/available_stock/edit_button/tooltip}{/s}',function(){ if(!this.articleDetail){ return}this.availableStockEditField.setValue(this.articleDetail.get("inStock"));this.setAvailableStockEditingHidden(false)});this.editAvailableStockButton.hide();this.editAvailableStockButtonPlaceholder=Ext.create("Ext.container.Container",{ width:20});this.saveChangedAvailableStockButton=this.createIconButton("sprite-tick",'{s name=field/available_stock/confirm_editing_button/tooltip}{/s}',function(){ var i=this.articleDetail.get("inStock");var e=this.availableStockEditField.getValue();if(e===i){ this.setAvailableStockEditingHidden(true);return}if(this.articleDetail.get("viisonNotRelevantForStockManager")){ this.fireEvent("viisonPickareERPSaveAvailableStock",this,this.articleDetail,e,i);this.setAvailableStockEditingHidden(true)}else{ Ext.Msg.show({ title:'{s name=alert/available_stock/confirm_editing/title}{/s}',msg:Ext.String.format('{s name=alert/available_stock/confirm_editing/message}{/s}',e),buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,scope:this,callback:function(t){ if(t!=="yes"){ return}this.fireEvent("viisonPickareERPSaveAvailableStock",this,this.articleDetail,e,i);this.setAvailableStockEditingHidden(true)}})}});this.saveChangedAvailableStockButton.hide();this.cancelChangedAvailableStockButtonHandler=function(){ this.reloadData(this.articleDetail);this.setAvailableStockEditingHidden(true);this.availableStockEditField.setValue(this.articleDetail.get("inStock"))}.bind(this);this.cancelChangedAvailableStockButton=this.createIconButton("sprite-cross",'{s name=field/available_stock/cancel_editing_button/tooltip}{/s}',this.cancelChangedAvailableStockButtonHandler);this.cancelChangedAvailableStockButton.hide();return this.createFieldContainer('{s name=field/available_stock/label}{/s}',[{ xtype:"label",text:"=",padding:"5 10 0 0",flex:1,style:{ "font-size":"1.3em","text-align":"right"}},this.availableStockField,this.availableStockEditField,this.editAvailableStockButton,this.editAvailableStockButtonPlaceholder,this.saveChangedAvailableStockButton,this.cancelChangedAvailableStockButton])},createFieldContainer:function(i,e){ return{ xtype:"fieldcontainer",fieldLabel:i,labelWidth:this.labelWidth,margin:0,layout:{ type:"hbox",align:"stretch"},items:e}},createIconButton:function(i,e,t){ return Ext.create("Ext.Img",{ cls:i,autoEl:{ tag:"div",style:"cursor: pointer; margin: 5px 2px;","data-qtip":e},listeners:{ scope:this,render:function(i){ i.getEl().on("click",function(){ (Ext.isFunction(t)?t.bind(this):Ext.emptyFn)(i)},this)}}})},setAvailableStockEditingHidden:function(i){ if(i){ this.availableStockField.show();this.editAvailableStockButton.show();this.availableStockEditField.hide();this.saveChangedAvailableStockButton.hide();this.cancelChangedAvailableStockButton.hide()}else{ this.availableStockField.hide();this.editAvailableStockButton.hide();this.availableStockEditField.show();this.saveChangedAvailableStockButton.show();this.cancelChangedAvailableStockButton.show()}}});
