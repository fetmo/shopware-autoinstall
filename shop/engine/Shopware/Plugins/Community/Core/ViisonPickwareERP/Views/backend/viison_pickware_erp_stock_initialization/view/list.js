// {namespace name=backend/viison_pickware_erp_stock_initialization/main}
Ext.define("Shopware.apps.ViisonPickwareERPStockInitialization.view.List",{ extend:"Ext.grid.Panel",alias:"widget.viison_pickware_erp_stock_initialization-list",cls:"x-tabpanel-child",viewConfig:{ getRowClass:function(e){ return!e.isSane()?"x-grid-row-viison-warning":""}},listeners:{ select:function(e,i){ if(!i.isSane()){ setTimeout(function(){ e.deselect(i)},300)}}},initComponent:function(){ var e=null;this.selModel=Ext.create("Ext.selection.CheckboxModel",{ mode:"SIMPLE",checkOnly:true});this.rowEditing=Ext.create("Ext.grid.plugin.RowEditing",{ clicksToEdit:2,listeners:{ scope:this,edit:function(e,i){ i.record.set("actualStock",i.newValues.instock+i.newValues.openOrders);i.record.set("purchasePrice",i.newValues.purchasePrice);i.record.save();this.getView().refreshNode(i.record)},beforeedit:function(){ var i=this.getSelectionModel();e=i.getSelection();var t=function(){ i.select(e)};i.on("selectionchange",t,i,{ single:true})},canceledit:function(){ var i=this.getSelectionModel();i.select(e)}}});this.plugins=[this.rowEditing];this.columns=[{ header:'{s name=list/column/article_number}{/s}',sortable:true,dataIndex:"orderNumber",flex:1},{ header:'{s name=list/column/article_name}{/s}',sortable:true,dataIndex:"articleName",flex:2,renderer:function(e,i,t){ var l=t.get("additionalText");if(l&&l.length>0){ return t.get("articleName")+" - "+l}return t.get("articleName")}},{ header:'{s name=list/column/supplier_name}{/s}',sortable:true,dataIndex:"supplier",flex:2},{ header:'{s name=list/column/available_stock/label}{/s}',sortable:true,dataIndex:"instock",flex:1,editor:{ xtype:"numberfield",allowBlank:false}},{ header:'{s name=list/column/reserved_stock/label}{/s}',sortable:true,dataIndex:"openOrders",flex:1},{ header:'{s name=list/column/physical_stock/label}{/s}',sortable:true,dataIndex:"actualStock",flex:1},{ header:ViisonPickwarePurchasePriceHelper.purchasePriceLabel(),sortable:true,dataIndex:"purchasePrice",flex:1,editor:{ xtype:"numberfield",allowBlank:false},renderer:ViisonCurrencyFormatter.renderer},{ xtype:"actioncolumn",width:50,items:[{ iconCls:"sprite-inbox",action:"articleopen",tooltip:'{s name=list/column/action/open_article/tooltip}{/s}',scope:this,handler:function(e,i){ this.fireEvent("openArticle",e.getStore().getAt(i))}},{ iconCls:"sprite-pencil",action:"startEdit",tooltip:'{s name=list/column/action/edit/tooltip}{/s}',scope:this,handler:function(e,i){ this.fireEvent("editRow",e.getStore().getAt(i))}}]}];this.dockedItems=[{ xtype:"toolbar",dock:"top",ui:"shopware-ui",items:["->",this.getToolbar(),{ xtype:"button",action:"initializeAll",text:'{s name=list/toolbar/button/initialize_all}{/s}',cls:"scondary small",scope:this,handler:function(){ this.fireEvent("initializeAll",this)}},{ xtype:"button",action:"applyChanges",text:'{s name=list/toolbar/button/confirm}{/s}',cls:"primary small",scope:this,handler:function(){ this.fireEvent("applyChanges",this)}}]},this.getPagingbar()];this.callParent(arguments)},getPagingbar:function(){ return{ xtype:"viison_common_pagination_toolbar-toolbar",store:this.store,paginationSteps:[100,250,500,1e3]}},getToolbar:function(){ return{ xtype:"textfield",name:"searchfield",cls:"searchfield",enableKeyEvents:true,emptyText:'{s name=search/initialText}{/s}',listeners:{ buffer:500,scope:this,change:function(e){ this.applyFilter(e.value)}}}},applyFilter:function(e){ this.store.clearFilter(true);this.store.getProxy().extraParams.filterStr=e;this.store.currentPage=1;this.store.load()}});
