// {namespace name=backend/viison_pickware_erp_article_supplier_order_list/main}
Ext.define("Shopware.apps.ViisonPickwareERPArticleSupplierOrderList.controller.Main",{ extend:"Ext.app.Controller",totalIncomingStock:0,init:function(){ this.control({ "viison_pickware_erp_article_supplier_order_list-detail-supplier_order_list viison_common_variant_combo_box-combo_box":{ variantChanged:this.onVariantChanged}});this.supplierOrderStore=this.getStore("Shopware.apps.ViisonPickwareERPArticleSupplierOrderList.store.Order");this.callParent(arguments)},createOrderListTab:function(){ var i=this.getStore("Shopware.apps.ViisonPickwareERPSupplierOrders.store.order.Status");var e=Ext.create("Shopware.apps.ViisonPickwareERPArticleSupplierOrderList.view.detail.SupplierOrderList",{ store:this.supplierOrderStore,orderStatusStore:i,totalIncomingStock:this.totalIncomingStock});i.on("load",function(){ e.reconfigure(this.supplierOrderStore)},this);this.subApplication.on("ProductModule:storesChanged",this.articleChanged,e);this.supplierOrderStore.on("load",function(i){ var t=i.getProxy().reader.rawData;if(t&&typeof t.totalIncomingStock!=="undefined"){ this.totalIncomingStock=t.totalIncomingStock}if(e.totalIncomingStockLabel){ e.totalIncomingStockLabel.update({ totalIncomingStock:this.totalIncomingStock})}},this);var t=e.down("viison_common_variant_combo_box-combo_box");t.setArticle(this.article);return e},onVariantChanged:function(i,e){ if(i){ this.loadSupplierOrders(i,e)}else{ this.supplierOrderStore.clearFilter(true);this.supplierOrderStore.removeAll()}},setArticle:function(i){ this.article=i},loadSupplierOrders:function(i,e){ var t=e.up("viison_pickware_erp_article_supplier_order_list-detail-supplier_order_list");if(t){ t.setLoading(true)}this.supplierOrderStore.filters.add("articleDetail",Ext.create("Ext.util.Filter",{ property:"articles.articleDetailId",value:i.get("id")}));this.supplierOrderStore.loadPage(1,{ callback:function(i,e,r){ if(t){ t.setLoading(false)}if(!r){ Shopware.Notification.createGrowlMessage('{s name=notification/error/title}{/s}','{s name=notification/error/message/load}{/s}',"ViisonPickwareERPArticleSupplierOrderList")}}})},articleChanged:function(i){ this.down("viison_common_variant_combo_box-combo_box").setArticle(i)}});
