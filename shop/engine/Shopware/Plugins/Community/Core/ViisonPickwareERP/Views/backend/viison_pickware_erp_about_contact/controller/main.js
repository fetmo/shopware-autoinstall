// {namespace name="backend/viison_pickware_erp_about/contact"}
Ext.define("Shopware.apps.ViisonPickwareERPAboutContact.controller.Main",{ extend:"Ext.app.Controller",init:function(){ this.control({ "viison_common_mail_composer-window viison_common_mail_composer-main":{ sendMail:this.onSendMail}});var i='\n\n--\n{s name=mail/body/headline}{/s}\n'+'{s name=mail/body/shop_url}{/s}{$shopURL}\n'+'{s name=mail/body/shopware_version}{/s}{$shopwareVersion}\n'+'{s name=mail/body/pickware_plugin_version}{/s}{$pickwarePluginVersion}';this.mainWindow=Ext.create("Shopware.apps.ViisonCommonMailComposer.view.Window",{ subApp:this.subApplication,hideAttachmentField:true,mail:{ toAddress:"info@pickware.de",subject:'{s name=mail/subject}{/s}',content:i}});this.mainWindow.setTitle('{s name=window/title}{/s}');this.phonePanel=Ext.create("Ext.container.Container",{ style:{ "text-align":"center",margin:"5px","padding-top":"10px","background-color":"transparent",color:"#475c6a"},html:'<div>{s name=phone/msg}{/s}</div>'+'<div style="font-weight:bold; font-size:120%; padding-top:5px">{s name=phone/nr}{/s}</div>'});this.mainWindow.dataPanel.add(this.phonePanel);this.mainWindow.show()},onSendMail:function(i){ if(!i.getForm().isValid()){ return}var I=i.getValues();var S=i.up("viison_common_mail_composer-window");S.setLoading(true);Ext.Ajax.request({ url:'{url controller=ViisonPickwareERPAboutContact action=sendEmail}',params:I,success:function(i){ S.setLoading(false);var I=Ext.JSON.decode(i.responseText,true);if(I.success){ Shopware.Notification.createGrowlMessage('{s name=notification/success/title}{/s}','{s name=notification/success/message}{/s}',"ViisonPickwareERPAboutContact");S.close()}else{ Shopware.Notification.createGrowlMessage('{s name=notification/error/title}{/s}','{s name=notification/error/message}{/s}',"ViisonPickwareERPAboutContact")}}})}});
